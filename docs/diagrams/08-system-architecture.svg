<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1680" font-family="'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <!-- Gradients -->
    <linearGradient id="bgGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#0D1117"/>
      <stop offset="100%" stop-color="#0F1525"/>
    </linearGradient>
    <linearGradient id="goldGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#C9A227"/>
      <stop offset="100%" stop-color="#D4AF37"/>
    </linearGradient>
    <linearGradient id="coreGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1a1a3e"/>
      <stop offset="100%" stop-color="#12122a"/>
    </linearGradient>
    <linearGradient id="infraGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1a2a1a"/>
      <stop offset="100%" stop-color="#122212"/>
    </linearGradient>
    <linearGradient id="presGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#2a1a1a"/>
      <stop offset="100%" stop-color="#221212"/>
    </linearGradient>
    <linearGradient id="appGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1a2a2a"/>
      <stop offset="100%" stop-color="#122222"/>
    </linearGradient>
    <linearGradient id="dataGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#2a2a1a"/>
      <stop offset="100%" stop-color="#222212"/>
    </linearGradient>

    <!-- Glow filter -->
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="softGlow">
      <feGaussianBlur stdDeviation="2" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>

    <!-- Arrow markers -->
    <marker id="arrowGold" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#C9A227" stroke-width="1.5"/>
    </marker>
    <marker id="arrowCyan" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#56d4e8" stroke-width="1.5"/>
    </marker>
    <marker id="arrowGreen" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#4ade80" stroke-width="1.5"/>
    </marker>
    <marker id="arrowPurple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#a78bfa" stroke-width="1.5"/>
    </marker>
    <marker id="arrowAmber" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#fbbf24" stroke-width="1.5"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="1680" fill="url(#bgGrad)"/>

  <!-- Title -->
  <text x="700" y="52" text-anchor="middle" fill="url(#goldGrad)" font-size="28" font-weight="700" filter="url(#glow)">The Primer — System Architecture</text>
  <text x="700" y="78" text-anchor="middle" fill="#8b949e" font-size="13">Clean Architecture  ·  Local-First  ·  Dependency Injection</text>

  <!-- ════════════════════════════════════════════════════ -->
  <!-- LAYER 1: APP LAYER (Next.js Routes) -->
  <!-- ════════════════════════════════════════════════════ -->
  <rect x="40" y="100" width="1320" height="200" rx="12" fill="url(#appGrad)" stroke="#56d4e8" stroke-width="1.5" opacity="0.9"/>
  <text x="60" y="128" fill="#56d4e8" font-size="15" font-weight="700" filter="url(#softGlow)">APP LAYER</text>
  <text x="200" y="128" fill="#4a5568" font-size="11">src/app/</text>

  <!-- Root Layout box -->
  <rect x="60" y="142" width="280" height="146" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="72" y="162" fill="#e2e8f0" font-size="12" font-weight="600">Root Layout (Providers)</text>
  <text x="72" y="180" fill="#8b949e" font-size="10">ClerkProvider (optional)</text>
  <text x="72" y="194" fill="#8b949e" font-size="10">ThemeProvider (next-themes)</text>
  <text x="72" y="208" fill="#8b949e" font-size="10">QueryProvider (TanStack)</text>
  <text x="72" y="222" fill="#8b949e" font-size="10">AudioProvider</text>
  <text x="72" y="236" fill="#8b949e" font-size="10">ToastProvider</text>
  <text x="72" y="254" fill="#56d4e8" font-size="9">Fonts: Inter · Amiri · Scheherazade · Cormorant</text>

  <!-- Page Routes box -->
  <rect x="360" y="142" width="320" height="146" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="372" y="162" fill="#e2e8f0" font-size="12" font-weight="600">Page Routes (app/)</text>
  <rect x="372" y="170" width="90" height="22" rx="4" fill="#1a2a2a" stroke="#56d4e8" stroke-width="0.5"/>
  <text x="417" y="185" text-anchor="middle" fill="#56d4e8" font-size="9">/surah/[id]</text>
  <rect x="468" y="170" width="66" height="22" rx="4" fill="#1a2a2a" stroke="#56d4e8" stroke-width="0.5"/>
  <text x="501" y="185" text-anchor="middle" fill="#56d4e8" font-size="9">/browse</text>
  <rect x="540" y="170" width="56" height="22" rx="4" fill="#1a2a2a" stroke="#56d4e8" stroke-width="0.5"/>
  <text x="568" y="185" text-anchor="middle" fill="#56d4e8" font-size="9">/notes</text>
  <rect x="602" y="170" width="66" height="22" rx="4" fill="#1a2a2a" stroke="#56d4e8" stroke-width="0.5"/>
  <text x="635" y="185" text-anchor="middle" fill="#56d4e8" font-size="9">/settings</text>

  <rect x="372" y="198" width="80" height="22" rx="4" fill="#1a2a2a" stroke="#56d4e8" stroke-width="0.5"/>
  <text x="412" y="213" text-anchor="middle" fill="#56d4e8" font-size="9">/bookmarks</text>
  <rect x="458" y="198" width="82" height="22" rx="4" fill="#1a2a2a" stroke="#56d4e8" stroke-width="0.5"/>
  <text x="499" y="213" text-anchor="middle" fill="#56d4e8" font-size="9">/knowledge</text>
  <rect x="546" y="198" width="82" height="22" rx="4" fill="#1a2a2a" stroke="#56d4e8" stroke-width="0.5"/>
  <text x="587" y="213" text-anchor="middle" fill="#56d4e8" font-size="9">/onboarding</text>

  <rect x="372" y="226" width="66" height="22" rx="4" fill="#1a2a2a" stroke="#3b4a3b" stroke-width="0.5"/>
  <text x="405" y="241" text-anchor="middle" fill="#6b7280" font-size="9">/sign-in</text>
  <rect x="444" y="226" width="66" height="22" rx="4" fill="#1a2a2a" stroke="#3b4a3b" stroke-width="0.5"/>
  <text x="477" y="241" text-anchor="middle" fill="#6b7280" font-size="9">/sign-up</text>
  <text x="520" y="241" fill="#4a5568" font-size="9">(Clerk)</text>

  <text x="372" y="276" fill="#4a5568" font-size="10">8 pages · PanelProvider + AppShell wrap (app/)</text>

  <!-- API Routes box -->
  <rect x="700" y="142" width="640" height="146" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="712" y="162" fill="#e2e8f0" font-size="12" font-weight="600">API Routes — /api/v1/</text>
  <text x="880" y="162" fill="#4a5568" font-size="10">16 endpoints · { ok, data, error, meta } envelope</text>

  <!-- Quran APIs -->
  <rect x="712" y="170" width="148" height="108" rx="6" fill="#111827" stroke="#1e3a5f" stroke-width="0.5"/>
  <text x="722" y="186" fill="#7dd3fc" font-size="10" font-weight="600">Quran</text>
  <text x="722" y="200" fill="#8b949e" font-size="9">GET /surahs</text>
  <text x="722" y="213" fill="#8b949e" font-size="9">GET /surahs/[id]</text>
  <text x="722" y="226" fill="#8b949e" font-size="9">GET /translations</text>
  <text x="722" y="239" fill="#8b949e" font-size="9">GET /search</text>
  <text x="722" y="252" fill="#8b949e" font-size="9">GET /tafsir · /tafsirs</text>
  <text x="722" y="265" fill="#8b949e" font-size="9">GET /audio · /reciters</text>

  <!-- Hadith APIs -->
  <rect x="870" y="170" width="148" height="108" rx="6" fill="#111827" stroke="#1e3a5f" stroke-width="0.5"/>
  <text x="880" y="186" fill="#7dd3fc" font-size="10" font-weight="600">Hadith</text>
  <text x="880" y="200" fill="#8b949e" font-size="9">GET /hadith</text>
  <text x="880" y="213" fill="#8b949e" font-size="9">GET /hadith/browse</text>
  <text x="880" y="226" fill="#8b949e" font-size="9">GET /hadith/related</text>
  <text x="880" y="239" fill="#8b949e" font-size="9">GET /hadith/concept-search</text>

  <!-- Other APIs -->
  <rect x="1028" y="170" width="148" height="108" rx="6" fill="#111827" stroke="#1e3a5f" stroke-width="0.5"/>
  <text x="1038" y="186" fill="#7dd3fc" font-size="10" font-weight="600">Cross-Domain</text>
  <text x="1038" y="200" fill="#8b949e" font-size="9">GET /cross-references</text>
  <text x="1038" y="213" fill="#8b949e" font-size="9">GET /ontology</text>
  <text x="1038" y="226" fill="#8b949e" font-size="9">GET /export</text>
  <text x="1038" y="239" fill="#8b949e" font-size="9">GET /health</text>

  <!-- Horizontal divider -->
  <line x1="1186" y1="170" x2="1186" y2="278" stroke="#1e3a5f" stroke-width="0.5" stroke-dasharray="3,3"/>

  <!-- Services.ts wiring note -->
  <rect x="1196" y="170" width="134" height="108" rx="6" fill="#111827" stroke="#C9A227" stroke-width="0.5" stroke-dasharray="4,2"/>
  <text x="1206" y="186" fill="#C9A227" font-size="10" font-weight="600">services.ts</text>
  <text x="1206" y="200" fill="#8b949e" font-size="9">server-only wiring</text>
  <text x="1206" y="218" fill="#6b7280" font-size="9">getQuranService()</text>
  <text x="1206" y="231" fill="#6b7280" font-size="9">getHadithAdapter()</text>
  <text x="1206" y="244" fill="#6b7280" font-size="9">getCrossRefAdapter()</text>
  <text x="1206" y="257" fill="#6b7280" font-size="9">getOntologyAdapter()</text>
  <text x="1206" y="272" fill="#4a5568" font-size="8">→ DI Container resolve</text>

  <!-- ════════════════════════════════════════════════════ -->
  <!-- LAYER 2: PRESENTATION LAYER -->
  <!-- ════════════════════════════════════════════════════ -->
  <rect x="40" y="320" width="1320" height="340" rx="12" fill="url(#presGrad)" stroke="#f87171" stroke-width="1.5" opacity="0.9"/>
  <text x="60" y="348" fill="#f87171" font-size="15" font-weight="700" filter="url(#softGlow)">PRESENTATION LAYER</text>
  <text x="270" y="348" fill="#4a5568" font-size="11">src/presentation/</text>

  <!-- Providers -->
  <rect x="60" y="360" width="200" height="130" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="72" y="380" fill="#e2e8f0" font-size="12" font-weight="600">Providers</text>
  <rect x="72" y="388" width="80" height="18" rx="3" fill="#2a1a1a" stroke="#f87171" stroke-width="0.5"/>
  <text x="112" y="401" text-anchor="middle" fill="#fca5a5" font-size="9">PanelProvider</text>
  <rect x="158" y="388" width="88" height="18" rx="3" fill="#2a1a1a" stroke="#f87171" stroke-width="0.5"/>
  <text x="202" y="401" text-anchor="middle" fill="#fca5a5" font-size="9">AudioProvider</text>
  <rect x="72" y="412" width="80" height="18" rx="3" fill="#2a1a1a" stroke="#f87171" stroke-width="0.5"/>
  <text x="112" y="425" text-anchor="middle" fill="#fca5a5" font-size="9">ThemeProvider</text>
  <rect x="158" y="412" width="88" height="18" rx="3" fill="#2a1a1a" stroke="#f87171" stroke-width="0.5"/>
  <text x="202" y="425" text-anchor="middle" fill="#fca5a5" font-size="9">QueryProvider</text>
  <text x="72" y="456" fill="#6b7280" font-size="9">Context + useState</text>
  <text x="72" y="468" fill="#6b7280" font-size="9">localStorage persistence</text>
  <text x="72" y="480" fill="#6b7280" font-size="9">SSR-safe hydration</text>

  <!-- Hooks -->
  <rect x="280" y="360" width="220" height="130" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="292" y="380" fill="#e2e8f0" font-size="12" font-weight="600">Hooks</text>
  <text x="292" y="396" fill="#fca5a5" font-size="9">useBookmarks · useNotes · useProgress</text>
  <text x="292" y="410" fill="#fca5a5" font-size="9">usePreferences · useKnowledgeGraph</text>
  <text x="292" y="424" fill="#fca5a5" font-size="9">useWorkspacePresets · useFetch</text>
  <text x="292" y="438" fill="#fca5a5" font-size="9">useVerseVisibility · useFocusSpotlight</text>
  <text x="292" y="452" fill="#fca5a5" font-size="9">useAutoHideNav · useGestures</text>
  <text x="292" y="470" fill="#6b7280" font-size="9">Dexie useLiveQuery for reactivity</text>
  <text x="292" y="482" fill="#6b7280" font-size="9">IntersectionObserver for visibility</text>

  <!-- Layout Components -->
  <rect x="520" y="360" width="230" height="130" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="532" y="380" fill="#e2e8f0" font-size="12" font-weight="600">Layout Components</text>
  <text x="532" y="398" fill="#fca5a5" font-size="9">AppShell — top-level chrome</text>
  <text x="532" y="412" fill="#fca5a5" font-size="9">PanelLayout — 3-dock resizable layout</text>
  <text x="532" y="426" fill="#fca5a5" font-size="9">DockGroup — per-dock panel renderer</text>
  <text x="532" y="440" fill="#fca5a5" font-size="9">TopNav · MobileNav · AudioDock</text>
  <text x="532" y="454" fill="#fca5a5" font-size="9">PanelShell — shared panel frame</text>
  <text x="532" y="472" fill="#6b7280" font-size="9">react-resizable-panels v4</text>
  <text x="532" y="484" fill="#6b7280" font-size="9">vaul Drawer (mobile only)</text>

  <!-- Reading Surface Components -->
  <rect x="60" y="500" width="330" height="148" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="72" y="520" fill="#e2e8f0" font-size="12" font-weight="600">Reading Surface</text>
  <text x="220" y="520" fill="#4a5568" font-size="10">5 modes</text>

  <rect x="72" y="528" width="60" height="20" rx="3" fill="#1a1520" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="102" y="542" text-anchor="middle" fill="#c4b5fd" font-size="8">Blocks</text>
  <rect x="138" y="528" width="52" height="20" rx="3" fill="#1a1520" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="164" y="542" text-anchor="middle" fill="#c4b5fd" font-size="8">Prose</text>
  <rect x="196" y="528" width="60" height="20" rx="3" fill="#1a1520" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="226" y="542" text-anchor="middle" fill="#c4b5fd" font-size="8">Theater</text>
  <rect x="262" y="528" width="52" height="20" rx="3" fill="#1a1520" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="288" y="542" text-anchor="middle" fill="#c4b5fd" font-size="8">Focus</text>
  <rect x="320" y="528" width="56" height="20" rx="3" fill="#1a1520" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="348" y="542" text-anchor="middle" fill="#c4b5fd" font-size="8">Mushaf</text>

  <text x="72" y="570" fill="#8b949e" font-size="9">VerseBlock — memo-optimized, DOMPurify</text>
  <text x="72" y="584" fill="#8b949e" font-size="9">VerseActionBar — bookmark/note/play/copy</text>
  <text x="72" y="598" fill="#8b949e" font-size="9">SurahHeader — sticky, collapsible</text>
  <text x="72" y="612" fill="#8b949e" font-size="9">ReadingProgressBar · ReadingToolbar</text>
  <text x="72" y="626" fill="#8b949e" font-size="9">TheaterSurface · TheaterVerse · MushafSurface</text>
  <text x="72" y="640" fill="#6b7280" font-size="9">IntersectionObserver · PointerEvent gestures</text>

  <!-- Panel Content Components -->
  <rect x="410" y="500" width="270" height="148" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="422" y="520" fill="#e2e8f0" font-size="12" font-weight="600">Panel Content</text>
  <text x="540" y="520" fill="#4a5568" font-size="10">5 panels</text>

  <rect x="422" y="528" width="50" height="18" rx="3" fill="#1a1520" stroke="#fbbf24" stroke-width="0.5"/>
  <text x="447" y="540" text-anchor="middle" fill="#fbbf24" font-size="8">Tafsir</text>
  <rect x="478" y="528" width="50" height="18" rx="3" fill="#1a1520" stroke="#4ade80" stroke-width="0.5"/>
  <text x="503" y="540" text-anchor="middle" fill="#4ade80" font-size="8">Hadith</text>
  <rect x="534" y="528" width="46" height="18" rx="3" fill="#1a1520" stroke="#60a5fa" stroke-width="0.5"/>
  <text x="557" y="540" text-anchor="middle" fill="#60a5fa" font-size="8">Notes</text>
  <rect x="586" y="528" width="44" height="18" rx="3" fill="#1a1520" stroke="#c084fc" stroke-width="0.5"/>
  <text x="608" y="540" text-anchor="middle" fill="#c084fc" font-size="8">AI</text>
  <rect x="636" y="528" width="34" height="18" rx="3" fill="#1a1520" stroke="#f472b6" stroke-width="0.5"/>
  <text x="653" y="540" text-anchor="middle" fill="#f472b6" font-size="8">Src</text>

  <text x="422" y="566" fill="#8b949e" font-size="9">TafsirSection — verse-linked commentary</text>
  <text x="422" y="580" fill="#8b949e" font-size="9">HadithSection — search/browse/filter</text>
  <text x="422" y="594" fill="#8b949e" font-size="9">NotesSection — TipTap editor + linked resources</text>
  <text x="422" y="608" fill="#8b949e" font-size="9">SourcesSection — cross-scripture refs</text>
  <text x="422" y="622" fill="#8b949e" font-size="9">HadithCard · NoteEditor · NotesList</text>
  <text x="422" y="640" fill="#6b7280" font-size="9">Color-coded by type · inline styles (Tailwind purge)</text>

  <!-- Knowledge Graph Component -->
  <rect x="700" y="500" width="300" height="148" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="712" y="520" fill="#e2e8f0" font-size="12" font-weight="600">Knowledge Graph</text>
  <text x="712" y="538" fill="#8b949e" font-size="9">NetworkGraph — D3.js force simulation</text>
  <text x="712" y="552" fill="#8b949e" font-size="9">useForceSimulation — physics engine</text>
  <text x="712" y="566" fill="#8b949e" font-size="9">useGraphInteractions — zoom/drag/click</text>
  <text x="712" y="584" fill="#8b949e" font-size="9">Node types: verse · note · bookmark · theme</text>
  <text x="712" y="598" fill="#8b949e" font-size="9">              surah · hadith · concept</text>
  <text x="712" y="616" fill="#8b949e" font-size="9">Edge types: references · thematic · same-surah</text>
  <text x="712" y="630" fill="#8b949e" font-size="9">             hadith-verse · concept-verse</text>
  <text x="712" y="644" fill="#6b7280" font-size="9">GraphControls · GraphLegend · GraphSearch</text>

  <!-- UI Primitives -->
  <rect x="1020" y="500" width="320" height="148" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="1032" y="520" fill="#e2e8f0" font-size="12" font-weight="600">UI Primitives</text>
  <text x="1140" y="520" fill="#4a5568" font-size="10">Shadcn/Radix</text>
  <text x="1032" y="540" fill="#8b949e" font-size="9">Button · Badge · Card · Dialog · Input</text>
  <text x="1032" y="554" fill="#8b949e" font-size="9">Label · RadioGroup · Checkbox · Separator</text>
  <text x="1032" y="568" fill="#8b949e" font-size="9">ScrollArea · Sheet · Skeleton · Tabs</text>
  <text x="1032" y="582" fill="#8b949e" font-size="9">Toast · Tooltip · EmptyState</text>
  <text x="1032" y="600" fill="#8b949e" font-size="9">ThemeSwitcher — 8 themes (4 light, 4 dark)</text>
  <text x="1032" y="618" fill="#8b949e" font-size="9">Resizable — re-exports react-resizable-panels v4</text>
  <text x="1032" y="644" fill="#6b7280" font-size="9">Tailwind v4 · HSL tokens · glass/glow utilities</text>

  <!-- Components in TopNav row -->
  <rect x="770" y="360" width="270" height="130" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="782" y="380" fill="#e2e8f0" font-size="12" font-weight="600">Surah Browser</text>
  <text x="782" y="398" fill="#8b949e" font-size="9">SurahBrowser — 114 surah grid</text>
  <text x="782" y="412" fill="#8b949e" font-size="9">Search · Juz filter · Revelation filter</text>
  <text x="782" y="426" fill="#8b949e" font-size="9">Progress indicators per surah</text>
  <text x="782" y="444" fill="#8b949e" font-size="9">BookmarksList — paginated bookmarks</text>
  <text x="782" y="458" fill="#8b949e" font-size="9">NotesList — search/sort/tag filter</text>
  <text x="782" y="476" fill="#6b7280" font-size="9">Export (JSON + Markdown) · Import</text>

  <!-- Workspace Presets -->
  <rect x="1060" y="360" width="280" height="130" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="1072" y="380" fill="#e2e8f0" font-size="12" font-weight="600">Workspace Presets</text>
  <text x="1200" y="380" fill="#4a5568" font-size="10">7 built-in</text>
  <rect x="1072" y="388" width="78" height="18" rx="3" fill="#1a1520" stroke="#C9A227" stroke-width="0.5"/>
  <text x="1111" y="400" text-anchor="middle" fill="#C9A227" font-size="8">Daily Reading</text>
  <rect x="1156" y="388" width="72" height="18" rx="3" fill="#1a1520" stroke="#C9A227" stroke-width="0.5"/>
  <text x="1192" y="400" text-anchor="middle" fill="#C9A227" font-size="8">Deep Study</text>
  <rect x="1234" y="388" width="94" height="18" rx="3" fill="#1a1520" stroke="#C9A227" stroke-width="0.5"/>
  <text x="1281" y="400" text-anchor="middle" fill="#C9A227" font-size="8">Translation Cmp</text>
  <rect x="1072" y="412" width="72" height="18" rx="3" fill="#1a1520" stroke="#C9A227" stroke-width="0.5"/>
  <text x="1108" y="424" text-anchor="middle" fill="#C9A227" font-size="8">Zen Reading</text>
  <rect x="1150" y="412" width="58" height="18" rx="3" fill="#1a1520" stroke="#C9A227" stroke-width="0.5"/>
  <text x="1179" y="424" text-anchor="middle" fill="#C9A227" font-size="8">Theater</text>
  <rect x="1214" y="412" width="68" height="18" rx="3" fill="#1a1520" stroke="#C9A227" stroke-width="0.5"/>
  <text x="1248" y="424" text-anchor="middle" fill="#C9A227" font-size="8">Focus Flow</text>
  <rect x="1288" y="412" width="40" height="18" rx="3" fill="#1a1520" stroke="#C9A227" stroke-width="0.5"/>
  <text x="1308" y="424" text-anchor="middle" fill="#C9A227" font-size="8">Mushaf</text>
  <text x="1072" y="454" fill="#6b7280" font-size="9">Each preset configures:</text>
  <text x="1072" y="468" fill="#8b949e" font-size="9">· readingFlow · panels · zenMode</text>
  <text x="1072" y="482" fill="#8b949e" font-size="9">· showTranslation · translationLayout</text>

  <!-- ════════════════════════════════════════════════════ -->
  <!-- LAYER 3: CORE LAYER (Domain) -->
  <!-- ════════════════════════════════════════════════════ -->
  <rect x="40" y="680" width="1320" height="280" rx="12" fill="url(#coreGrad)" stroke="#a78bfa" stroke-width="1.5" opacity="0.9"/>
  <text x="60" y="708" fill="#a78bfa" font-size="15" font-weight="700" filter="url(#softGlow)">CORE LAYER (Domain)</text>
  <text x="280" y="708" fill="#4a5568" font-size="11">src/core/ — zero framework imports</text>

  <!-- Types -->
  <rect x="60" y="720" width="380" height="226" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="72" y="740" fill="#e2e8f0" font-size="12" font-weight="600">Domain Types</text>
  <text x="180" y="740" fill="#4a5568" font-size="10">core/types/</text>

  <text x="72" y="760" fill="#c4b5fd" font-size="10" font-weight="600">quran.ts</text>
  <text x="72" y="774" fill="#8b949e" font-size="9">Surah · SurahWithVerses · Verse</text>
  <text x="72" y="787" fill="#8b949e" font-size="9">Translation · TranslationResource</text>
  <text x="72" y="800" fill="#8b949e" font-size="9">Tafsir · TafsirResource · Hadith</text>
  <text x="72" y="813" fill="#8b949e" font-size="9">HadithBook · HadithCollection</text>
  <text x="72" y="826" fill="#8b949e" font-size="9">AudioRecitation · Reciter</text>

  <text x="270" y="760" fill="#c4b5fd" font-size="10" font-weight="600">study.ts</text>
  <text x="270" y="774" fill="#8b949e" font-size="9">Bookmark · Note · LinkedResource</text>
  <text x="270" y="787" fill="#8b949e" font-size="9">ReadingProgress · UserPreferences</text>
  <text x="270" y="800" fill="#8b949e" font-size="9">TranslationConfig</text>
  <text x="270" y="813" fill="#8b949e" font-size="9">ReadingFlow · ThemeName</text>
  <text x="270" y="826" fill="#8b949e" font-size="9">WorkspacePreset (preset.ts)</text>

  <text x="72" y="848" fill="#c4b5fd" font-size="10" font-weight="600">graph.ts</text>
  <text x="72" y="862" fill="#8b949e" font-size="9">GraphNode · GraphEdge · KnowledgeGraph</text>
  <text x="72" y="876" fill="#8b949e" font-size="9">SimulationNode · SimulationEdge · GraphStats</text>

  <text x="270" y="848" fill="#c4b5fd" font-size="10" font-weight="600">ontology.ts · cross-reference.ts</text>
  <text x="270" y="862" fill="#8b949e" font-size="9">QuranicConcept · HadithVerseLink</text>
  <text x="270" y="876" fill="#8b949e" font-size="9">CrossScriptureCluster · CrossReference</text>

  <text x="72" y="896" fill="#c4b5fd" font-size="10" font-weight="600">api.ts</text>
  <text x="150" y="896" fill="#8b949e" font-size="9">ApiSuccess&lt;T&gt; · ApiError · ApiResponse&lt;T&gt; · ApiMeta</text>

  <text x="72" y="916" fill="#c4b5fd" font-size="10" font-weight="600">panel.ts</text>
  <text x="150" y="916" fill="#8b949e" font-size="9">PanelId · DockPosition · PanelConfig · PANEL_REGISTRY</text>

  <!-- Ports -->
  <rect x="460" y="720" width="420" height="226" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="472" y="740" fill="#e2e8f0" font-size="12" font-weight="600">Port Interfaces</text>
  <text x="600" y="740" fill="#4a5568" font-size="10">core/ports/ — contracts for adapters</text>

  <rect x="472" y="750" width="110" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="527" y="766" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">QuranPort</text>
  <text x="527" y="780" text-anchor="middle" fill="#6b7280" font-size="8">getSurah · search</text>
  <text x="527" y="790" text-anchor="middle" fill="#6b7280" font-size="8">getVerses · getAll</text>

  <rect x="590" y="750" width="110" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="645" y="766" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">TranslationPort</text>
  <text x="645" y="780" text-anchor="middle" fill="#6b7280" font-size="8">getTranslations</text>
  <text x="645" y="790" text-anchor="middle" fill="#6b7280" font-size="8">getAvailable</text>

  <rect x="708" y="750" width="110" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="763" y="766" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">TafsirPort</text>
  <text x="763" y="780" text-anchor="middle" fill="#6b7280" font-size="8">getTafsir</text>
  <text x="763" y="790" text-anchor="middle" fill="#6b7280" font-size="8">getAvailable</text>

  <rect x="472" y="804" width="110" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="527" y="820" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">HadithPort</text>
  <text x="527" y="834" text-anchor="middle" fill="#6b7280" font-size="8">search · browse</text>
  <text x="527" y="844" text-anchor="middle" fill="#6b7280" font-size="8">getByOntologyIds</text>

  <rect x="590" y="804" width="110" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="645" y="820" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">AudioPort</text>
  <text x="645" y="834" text-anchor="middle" fill="#6b7280" font-size="8">getReciters</text>
  <text x="645" y="844" text-anchor="middle" fill="#6b7280" font-size="8">getRecitation</text>

  <rect x="708" y="804" width="110" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="763" y="820" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">CrossRefPort</text>
  <text x="763" y="834" text-anchor="middle" fill="#6b7280" font-size="8">getCrossRefs</text>
  <text x="763" y="844" text-anchor="middle" fill="#6b7280" font-size="8">search</text>

  <rect x="472" y="858" width="110" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="527" y="874" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">OntologyPort</text>
  <text x="527" y="888" text-anchor="middle" fill="#6b7280" font-size="8">getConcepts</text>
  <text x="527" y="898" text-anchor="middle" fill="#6b7280" font-size="8">getTopics</text>

  <rect x="590" y="858" width="110" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="645" y="874" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">KnowledgeGraphPort</text>
  <text x="645" y="888" text-anchor="middle" fill="#6b7280" font-size="8">getGraph · addNode</text>
  <text x="645" y="898" text-anchor="middle" fill="#6b7280" font-size="8">addEdge · remove</text>

  <rect x="708" y="858" width="164" height="46" rx="4" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="790" y="874" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="600">Study Ports (4)</text>
  <text x="790" y="888" text-anchor="middle" fill="#6b7280" font-size="8">BookmarkRepo · NoteRepo</text>
  <text x="790" y="898" text-anchor="middle" fill="#6b7280" font-size="8">ProgressRepo · PrefsRepo</text>

  <!-- Services -->
  <rect x="900" y="720" width="440" height="226" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="912" y="740" fill="#e2e8f0" font-size="12" font-weight="600">Services</text>
  <text x="990" y="740" fill="#4a5568" font-size="10">core/services/</text>

  <rect x="912" y="752" width="408" height="90" rx="6" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="924" y="770" fill="#c4b5fd" font-size="11" font-weight="600">QuranService</text>
  <text x="924" y="786" fill="#8b949e" font-size="9">Unified facade over QuranPort + TranslationPort + TafsirPort + AudioPort</text>
  <text x="924" y="802" fill="#8b949e" font-size="9">getAllSurahs · getSurah · searchQuran · getTranslations</text>
  <text x="924" y="818" fill="#8b949e" font-size="9">getSurahWithMultipleTranslations (parallel fetch)</text>
  <text x="924" y="834" fill="#8b949e" font-size="9">getTafsir · getReciters · getRecitation · getVerseAudioUrl</text>

  <rect x="912" y="852" width="408" height="78" rx="6" fill="#1a1a3e" stroke="#a78bfa" stroke-width="0.5"/>
  <text x="924" y="870" fill="#c4b5fd" font-size="11" font-weight="600">KnowledgeGraphService</text>
  <text x="924" y="886" fill="#8b949e" font-size="9">Builds graph from BookmarkRepo + NoteRepo (client-side)</text>
  <text x="924" y="902" fill="#8b949e" font-size="9">5 tiers: verse nodes → note nodes → theme nodes → surah edges → hadith nodes</text>
  <text x="924" y="918" fill="#8b949e" font-size="9">enrichWithOntology() — hadith-verse, concept-verse, topic edges</text>

  <!-- ════════════════════════════════════════════════════ -->
  <!-- LAYER 4: INFRASTRUCTURE LAYER -->
  <!-- ════════════════════════════════════════════════════ -->
  <rect x="40" y="980" width="1320" height="310" rx="12" fill="url(#infraGrad)" stroke="#4ade80" stroke-width="1.5" opacity="0.9"/>
  <text x="60" y="1008" fill="#4ade80" font-size="15" font-weight="700" filter="url(#softGlow)">INFRASTRUCTURE LAYER</text>
  <text x="300" y="1008" fill="#4a5568" font-size="11">src/infrastructure/</text>

  <!-- Adapters -->
  <rect x="60" y="1020" width="580" height="258" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="72" y="1040" fill="#e2e8f0" font-size="12" font-weight="600">Adapters</text>
  <text x="152" y="1040" fill="#4a5568" font-size="10">Local-first pattern: bundled JSON → API fallback</text>

  <!-- Local adapters -->
  <text x="72" y="1060" fill="#4ade80" font-size="10" font-weight="600">Local-First (offline capable)</text>
  <rect x="72" y="1068" width="264" height="26" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="84" y="1085" fill="#86efac" font-size="9">QuranLocalAdapter → QuranPort</text>
  <text x="288" y="1085" fill="#6b7280" font-size="8">data/quran/</text>

  <rect x="72" y="1098" width="264" height="26" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="84" y="1115" fill="#86efac" font-size="9">TranslationLocalAdapter → TranslationPort</text>
  <text x="288" y="1115" fill="#6b7280" font-size="8">+ API fallback</text>

  <rect x="72" y="1128" width="264" height="26" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="84" y="1145" fill="#86efac" font-size="9">TafsirLocalAdapter → TafsirPort</text>
  <text x="288" y="1145" fill="#6b7280" font-size="8">+ API fallback</text>

  <rect x="72" y="1158" width="264" height="26" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="84" y="1175" fill="#86efac" font-size="9">HadithLocalAdapter → HadithPort</text>
  <text x="288" y="1175" fill="#6b7280" font-size="8">+ API fallback</text>

  <rect x="72" y="1188" width="264" height="26" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="84" y="1205" fill="#86efac" font-size="9">OntologyLocalAdapter → OntologyPort</text>
  <text x="288" y="1205" fill="#6b7280" font-size="8">data/ontology/</text>

  <!-- Remote adapters -->
  <text x="360" y="1060" fill="#7dd3fc" font-size="10" font-weight="600">Remote Only</text>
  <rect x="360" y="1068" width="264" height="26" rx="4" fill="#0d1a2a" stroke="#7dd3fc" stroke-width="0.5"/>
  <text x="372" y="1085" fill="#7dd3fc" font-size="9">AudioAdapter → AudioPort</text>
  <text x="556" y="1085" fill="#6b7280" font-size="8">quran.com API</text>

  <rect x="360" y="1098" width="264" height="26" rx="4" fill="#0d1a2a" stroke="#7dd3fc" stroke-width="0.5"/>
  <text x="372" y="1115" fill="#7dd3fc" font-size="9">CrossReferenceAdapter → CrossRefPort</text>
  <text x="556" y="1115" fill="#6b7280" font-size="8">scripturas.info</text>

  <rect x="360" y="1128" width="264" height="26" rx="4" fill="#0d1a2a" stroke="#7dd3fc" stroke-width="0.5"/>
  <text x="372" y="1145" fill="#7dd3fc" font-size="9">QuranTranslationAdapter</text>
  <text x="556" y="1145" fill="#6b7280" font-size="8">quran.com API</text>

  <rect x="360" y="1158" width="264" height="26" rx="4" fill="#0d1a2a" stroke="#7dd3fc" stroke-width="0.5"/>
  <text x="372" y="1175" fill="#7dd3fc" font-size="9">TafsirAdapter</text>
  <text x="556" y="1175" fill="#6b7280" font-size="8">quran.com API</text>

  <rect x="360" y="1188" width="264" height="26" rx="4" fill="#0d1a2a" stroke="#7dd3fc" stroke-width="0.5"/>
  <text x="372" y="1205" fill="#7dd3fc" font-size="9">HadithAdapter</text>
  <text x="556" y="1205" fill="#6b7280" font-size="8">sunnah.com API</text>

  <text x="72" y="1248" fill="#6b7280" font-size="9">Local adapters wrap remote adapters: try bundled file (fs/promises + LruCache) → on miss, delegate to API adapter → merge &amp; deduplicate</text>
  <text x="72" y="1264" fill="#6b7280" font-size="9">HadithLocalAdapter includes term-frequency search with 40% match threshold for offline hadith search</text>

  <!-- Database -->
  <rect x="660" y="1020" width="340" height="258" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="672" y="1040" fill="#e2e8f0" font-size="12" font-weight="600">Client Database</text>
  <text x="800" y="1040" fill="#4a5568" font-size="10">Dexie (IndexedDB) · v7</text>

  <text x="672" y="1060" fill="#4ade80" font-size="10" font-weight="600">Tables</text>
  <rect x="672" y="1068" width="148" height="22" rx="3" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="746" y="1083" text-anchor="middle" fill="#86efac" font-size="9">bookmarks</text>
  <rect x="826" y="1068" width="148" height="22" rx="3" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="900" y="1083" text-anchor="middle" fill="#86efac" font-size="9">notes</text>
  <rect x="672" y="1096" width="148" height="22" rx="3" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="746" y="1111" text-anchor="middle" fill="#86efac" font-size="9">progress</text>
  <rect x="826" y="1096" width="148" height="22" rx="3" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="900" y="1111" text-anchor="middle" fill="#86efac" font-size="9">preferences</text>
  <rect x="672" y="1124" width="148" height="22" rx="3" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="746" y="1139" text-anchor="middle" fill="#86efac" font-size="9">graphNodes</text>
  <rect x="826" y="1124" width="148" height="22" rx="3" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="900" y="1139" text-anchor="middle" fill="#86efac" font-size="9">graphEdges</text>
  <rect x="672" y="1152" width="302" height="22" rx="3" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="823" y="1167" text-anchor="middle" fill="#86efac" font-size="9">crossReferences</text>

  <text x="672" y="1196" fill="#4ade80" font-size="10" font-weight="600">Repository Classes</text>
  <text x="672" y="1212" fill="#8b949e" font-size="9">DexieBookmarkRepo · DexieNoteRepo</text>
  <text x="672" y="1226" fill="#8b949e" font-size="9">DexieProgressRepo · DexiePreferencesRepo</text>
  <text x="672" y="1240" fill="#8b949e" font-size="9">DexieGraphRepo · DexieCrossRefRepo</text>
  <text x="672" y="1258" fill="#6b7280" font-size="9">Reactive via useLiveQuery · multiEntry indexes</text>

  <!-- Utilities -->
  <rect x="1020" y="1020" width="320" height="258" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="1032" y="1040" fill="#e2e8f0" font-size="12" font-weight="600">Utilities</text>

  <rect x="1032" y="1052" width="296" height="58" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="1044" y="1070" fill="#86efac" font-size="10" font-weight="600">HttpClient</text>
  <text x="1044" y="1084" fill="#8b949e" font-size="9">GET/POST · exponential backoff retry</text>
  <text x="1044" y="1098" fill="#8b949e" font-size="9">Configurable timeout (10s) · retries (3)</text>

  <rect x="1032" y="1116" width="296" height="46" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="1044" y="1134" fill="#86efac" font-size="10" font-weight="600">LruCache&lt;V&gt;</text>
  <text x="1044" y="1148" fill="#8b949e" font-size="9">TTL eviction · Map insertion order · max size</text>

  <rect x="1032" y="1168" width="296" height="46" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="1044" y="1186" fill="#86efac" font-size="10" font-weight="600">Logger (Pino)</text>
  <text x="1044" y="1200" fill="#8b949e" font-size="9">Structured JSON · createLogger({ module })</text>

  <rect x="1032" y="1220" width="142" height="46" rx="4" fill="#1a2a1a" stroke="#C9A227" stroke-width="0.5"/>
  <text x="1044" y="1238" fill="#C9A227" font-size="10" font-weight="600">DI Container</text>
  <text x="1044" y="1252" fill="#8b949e" font-size="9">register · resolve</text>

  <rect x="1182" y="1220" width="146" height="46" rx="4" fill="#1a2a1a" stroke="#4ade80" stroke-width="0.5"/>
  <text x="1194" y="1238" fill="#86efac" font-size="10" font-weight="600">API Helpers</text>
  <text x="1194" y="1252" fill="#8b949e" font-size="9">toResponse · badRequest</text>

  <!-- ════════════════════════════════════════════════════ -->
  <!-- LAYER 5: DATA LAYER -->
  <!-- ════════════════════════════════════════════════════ -->
  <rect x="40" y="1310" width="1320" height="160" rx="12" fill="url(#dataGrad)" stroke="#fbbf24" stroke-width="1.5" opacity="0.9"/>
  <text x="60" y="1338" fill="#fbbf24" font-size="15" font-weight="700" filter="url(#softGlow)">DATA LAYER (Bundled)</text>
  <text x="290" y="1338" fill="#4a5568" font-size="11">data/ — ships with app, no CDN required · ~71 MB total</text>

  <rect x="60" y="1350" width="230" height="108" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="72" y="1370" fill="#fbbf24" font-size="11" font-weight="600">Arabic Text</text>
  <text x="210" y="1370" fill="#6b7280" font-size="9">3.5 MB</text>
  <text x="72" y="1388" fill="#8b949e" font-size="9">114 surahs · Uthmani + Simple</text>
  <text x="72" y="1402" fill="#8b949e" font-size="9">data/quran/surahs/001–114.json</text>
  <text x="72" y="1420" fill="#fbbf24" font-size="11" font-weight="600">Translations</text>
  <text x="210" y="1420" fill="#6b7280" font-size="9">6.4 MB</text>
  <text x="72" y="1438" fill="#8b949e" font-size="9">6 English translations x 114 files</text>
  <text x="72" y="1452" fill="#8b949e" font-size="9">Khattab · Yusuf Ali · Pickthall · ...</text>

  <rect x="310" y="1350" width="250" height="108" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="322" y="1370" fill="#fbbf24" font-size="11" font-weight="600">Tafsirs</text>
  <text x="460" y="1370" fill="#6b7280" font-size="9">41 MB</text>
  <text x="322" y="1388" fill="#8b949e" font-size="9">3 tafsirs x 114 files</text>
  <text x="322" y="1402" fill="#8b949e" font-size="9">Ibn Kathir · Al-Jalalayn · Tazkirul Quran</text>
  <text x="322" y="1420" fill="#fbbf24" font-size="11" font-weight="600">Hadith</text>
  <text x="460" y="1420" fill="#6b7280" font-size="9">20 MB</text>
  <text x="322" y="1438" fill="#8b949e" font-size="9">6 collections · 33,738 hadiths</text>
  <text x="322" y="1452" fill="#8b949e" font-size="9">Bukhari · Muslim · Abu Dawud · ...</text>

  <rect x="580" y="1350" width="270" height="108" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="592" y="1370" fill="#fbbf24" font-size="11" font-weight="600">Ontology</text>
  <text x="592" y="1388" fill="#8b949e" font-size="9">ontology.json — Quranic concepts</text>
  <text x="592" y="1402" fill="#8b949e" font-size="9">  concepts → verses, subcategories, related</text>
  <text x="592" y="1420" fill="#fbbf24" font-size="11" font-weight="600">Semantic Hadith Mapping</text>
  <text x="592" y="1438" fill="#8b949e" font-size="9">hadith-verses.json — verse ↔ hadith links</text>
  <text x="592" y="1452" fill="#8b949e" font-size="9">hadith-topics.json · topics.json</text>

  <!-- External APIs -->
  <rect x="870" y="1350" width="470" height="108" rx="8" fill="#0d1117" stroke="#2d3748" stroke-width="1"/>
  <text x="882" y="1370" fill="#7dd3fc" font-size="11" font-weight="600">External APIs (fallback / remote-only)</text>

  <rect x="882" y="1380" width="130" height="30" rx="4" fill="#0d1a2a" stroke="#7dd3fc" stroke-width="0.5"/>
  <text x="947" y="1400" text-anchor="middle" fill="#7dd3fc" font-size="9">Quran.com API v4</text>
  <rect x="1018" y="1380" width="130" height="30" rx="4" fill="#0d1a2a" stroke="#7dd3fc" stroke-width="0.5"/>
  <text x="1083" y="1400" text-anchor="middle" fill="#7dd3fc" font-size="9">Sunnah.com API</text>
  <rect x="1154" y="1380" width="130" height="30" rx="4" fill="#0d1a2a" stroke="#7dd3fc" stroke-width="0.5"/>
  <text x="1219" y="1400" text-anchor="middle" fill="#7dd3fc" font-size="9">Scripturas.info</text>

  <text x="882" y="1438" fill="#6b7280" font-size="9">Translations, tafsirs, audio, reciters</text>
  <text x="1070" y="1438" fill="#6b7280" font-size="9">Hadith search</text>
  <text x="1200" y="1438" fill="#6b7280" font-size="9">Cross-refs</text>
  <text x="882" y="1454" fill="#4a5568" font-size="9">HttpClient with retry + backoff · LruCache per adapter</text>

  <!-- ════════════════════════════════════════════════════ -->
  <!-- DATA FLOW ARROWS -->
  <!-- ════════════════════════════════════════════════════ -->

  <!-- App → Presentation (pages render components) -->
  <line x1="520" y1="300" x2="520" y2="320" stroke="#56d4e8" stroke-width="1.5" marker-end="url(#arrowCyan)"/>
  <line x1="900" y1="300" x2="900" y2="320" stroke="#56d4e8" stroke-width="1.5" marker-end="url(#arrowCyan)"/>

  <!-- API Routes → services.ts → Core (API routes call services) -->
  <line x1="1263" y1="300" x2="1263" y2="680" stroke="#C9A227" stroke-width="1.5" stroke-dasharray="6,3" marker-end="url(#arrowGold)"/>
  <text x="1275" y="500" fill="#C9A227" font-size="8" transform="rotate(90, 1275, 500)">DI resolve</text>

  <!-- Presentation → Core (hooks use types, services use ports) -->
  <line x1="300" y1="660" x2="300" y2="680" stroke="#a78bfa" stroke-width="1.5" marker-end="url(#arrowPurple)"/>
  <line x1="600" y1="660" x2="600" y2="680" stroke="#a78bfa" stroke-width="1.5" marker-end="url(#arrowPurple)"/>

  <!-- Core → Infrastructure (ports implemented by adapters) -->
  <line x1="300" y1="960" x2="300" y2="980" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrowGreen)"/>
  <line x1="700" y1="960" x2="700" y2="980" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrowGreen)"/>
  <line x1="1100" y1="960" x2="1100" y2="980" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

  <!-- Infrastructure → Data (adapters read bundled data) -->
  <line x1="300" y1="1290" x2="300" y2="1310" stroke="#fbbf24" stroke-width="1.5" marker-end="url(#arrowAmber)"/>
  <line x1="830" y1="1290" x2="830" y2="1310" stroke="#fbbf24" stroke-width="1.5" marker-end="url(#arrowAmber)"/>
  <line x1="1100" y1="1290" x2="1100" y2="1310" stroke="#fbbf24" stroke-width="1.5" marker-end="url(#arrowAmber)"/>

  <!-- Presentation hooks → Dexie (client DB) -->
  <path d="M390,490 L390,520 C390,540 500,540 660,1020" fill="none" stroke="#f87171" stroke-width="1" stroke-dasharray="4,3" opacity="0.4"/>

  <!-- ════════════════════════════════════════════════════ -->
  <!-- DEPENDENCY RULE ANNOTATION -->
  <!-- ════════════════════════════════════════════════════ -->

  <!-- Dependency rule arrow on right side -->
  <line x1="1380" y1="130" x2="1380" y2="1440" stroke="#C9A227" stroke-width="2" opacity="0.3"/>
  <polygon points="1374,130 1386,130 1380,118" fill="#C9A227" opacity="0.5"/>
  <text x="1390" y="790" fill="#C9A227" font-size="10" opacity="0.5" transform="rotate(90, 1390, 790)">Dependency Rule: outer layers depend on inner layers, never the reverse</text>

  <!-- ════════════════════════════════════════════════════ -->
  <!-- LEGEND -->
  <!-- ════════════════════════════════════════════════════ -->
  <rect x="40" y="1500" width="1320" height="160" rx="12" fill="#0d1117" stroke="#2d3748" stroke-width="1" opacity="0.8"/>
  <text x="700" y="1528" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="600">Architecture Legend</text>

  <!-- Layer colors -->
  <rect x="80" y="1542" width="16" height="16" rx="3" fill="none" stroke="#56d4e8" stroke-width="2"/>
  <text x="104" y="1554" fill="#8b949e" font-size="11">App Layer (Next.js routes, layout)</text>

  <rect x="80" y="1566" width="16" height="16" rx="3" fill="none" stroke="#f87171" stroke-width="2"/>
  <text x="104" y="1578" fill="#8b949e" font-size="11">Presentation (React components, hooks, providers)</text>

  <rect x="80" y="1590" width="16" height="16" rx="3" fill="none" stroke="#a78bfa" stroke-width="2"/>
  <text x="104" y="1602" fill="#8b949e" font-size="11">Core (domain types, port interfaces, services)</text>

  <rect x="80" y="1614" width="16" height="16" rx="3" fill="none" stroke="#4ade80" stroke-width="2"/>
  <text x="104" y="1626" fill="#8b949e" font-size="11">Infrastructure (adapters, DB, HTTP, cache)</text>

  <rect x="80" y="1638" width="16" height="16" rx="3" fill="none" stroke="#fbbf24" stroke-width="2"/>
  <text x="104" y="1650" fill="#8b949e" font-size="11">Data (bundled JSON, external APIs)</text>

  <!-- Data flow -->
  <line x1="600" y1="1549" x2="660" y2="1549" stroke="#C9A227" stroke-width="1.5" stroke-dasharray="6,3" marker-end="url(#arrowGold)"/>
  <text x="670" y="1554" fill="#8b949e" font-size="11">DI container wiring (server-only)</text>

  <line x1="600" y1="1573" x2="660" y2="1573" stroke="#56d4e8" stroke-width="1.5" marker-end="url(#arrowCyan)"/>
  <text x="670" y="1578" fill="#8b949e" font-size="11">Page → Component data flow</text>

  <line x1="600" y1="1597" x2="660" y2="1597" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrowGreen)"/>
  <text x="670" y="1602" fill="#8b949e" font-size="11">Port → Adapter implementation</text>

  <line x1="600" y1="1621" x2="660" y2="1621" stroke="#fbbf24" stroke-width="1.5" marker-end="url(#arrowAmber)"/>
  <text x="670" y="1626" fill="#8b949e" font-size="11">Adapter → Data source</text>

  <!-- Stats -->
  <text x="1000" y="1554" fill="#e2e8f0" font-size="11" font-weight="600">Stats</text>
  <text x="1000" y="1574" fill="#8b949e" font-size="10">23 routes (8 static, 15 dynamic)</text>
  <text x="1000" y="1592" fill="#8b949e" font-size="10">16 API endpoints · 9 port interfaces</text>
  <text x="1000" y="1610" fill="#8b949e" font-size="10">10 adapters · 6 Dexie repositories</text>
  <text x="1000" y="1628" fill="#8b949e" font-size="10">32 test files · 7 Dexie tables (v7)</text>
  <text x="1000" y="1646" fill="#8b949e" font-size="10">~71 MB bundled data · 33,738 hadiths</text>
</svg>
